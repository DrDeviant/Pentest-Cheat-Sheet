<h1>Target SMB service</h1> 

**Summery:** 

- [Enumeration](#enumeration)
  - [nmap](#nmap)
  - [nbtscan](#nbtscan)
  - [nmblookup (nbtstat)](#nmblookup-nbtstat)
  - [smbmap](#smbmap)
- [Connect](#connect)
- [Brut Force](#brut-force)
  - [hydra](#hydra)
  - [nmap](#nmap-1)
- [Download all the dir](#download-all-the-dir)
- [Mount remote dir](#mount-remote-dir)

## Enumeration

### nmap
    nmap --script smb-vuln* -p 445 <ipAddress>

    nmap -p 139,445 --script vuln -oA nmap-Vuln <ipAddress>

    nmap --script smb-enum-shares -p 139,445 <ipAddress>
    nmap --script=smb-enum* --script-args=unsafe=1 -T5 $ip

### nbtscan
    nbtscan -r <ipAddress>

### nmblookup (nbtstat)
    nmblookup -A <ipAddress>

### smbmap
    
    smbmap -H <ipAddress> -u guest
    smbmap -H <ipAddress> -R -depth 5

    -R : recursive + the depth



## Connect 
Anonymous mount:

    smbclient -L //<ipAddress>
    smbclient \\\\<ipAddress>\\<DIR>

Client mount:

> rpcclient
> 
    rpcclient -U "" -N <ipAddress>
    rpcclient -U "guest" -N <ipAddress>

Interaction 

    rpcclient
    > enumdomusers

    user:[Guest] rid:[0x1f5]
    user:[AAD_987d7f2f57d2] rid:[0x450]

    > enumdomgroups

        group:[Domain Users] rid:[0x201]
        group:[Domain Guests] rid:[0x202]
        group:[Domain Computers] rid:[0x203]

    > querygroup 0x201

        Group Name:	Domain Users
        Description:	
        Group Attribute:7
        Num Members:11

    > querygroupmem 0x44f

        rid:[0x451] attr:[0x7]

    > queryuser 0x451

        User Name   :	ryan
        Full Name   :	Ryan Bertrand

    getusrdompwinfo 0x451
> rpcinfo
>
    rpcinfo -p <ip>
    nfs-utils

> showmount
> 
    showmount -e <ip>

## Brut Force 
### hydra

    hydra -L user.txt -P pass.txt <ipAddress> smb
### nmap
    nmap -T4 -v -oA shares --script smb-enum-shares --script-args smbuser=username,smbpass=password -p445 <ipAddress>/24


## Download all the dir 
    smbclient \\\\<ipAddress>\\<DIR>
    recurse ON
    prompt OFF
    mget *



## Mount remote dir 
    mkdir /mnt/remoteDir
    mount -t cifs -o user=guest //<ipAddress>/<DIR> /mnt/remoteDir