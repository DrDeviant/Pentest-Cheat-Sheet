# Linux privilege escalation
## Get info 
OS & Architecture & Kernel version:  
- `cat /proc/version`
- `uname -a`
- `uname -a` 

Ubuntu version:

    cat /etc/issue
    lsb_release -a

## cron
    crontab -l
    ls /etc/cron*
    ls -alh /var/spool/cron
    ls /etc/at.*
    
find / -perm -222 -type d 2>/dev/null

## Id hash

    hash-identifier

## Exploit sudo 

https://gtfobins.github.io

### Check environment 

Check any restricitions on any folders  

    mount -l        >> any no exec or no suid?  

Check any unmounted drives

    cat /etc/fstab  

### SUID

Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here.  
```bash
find / -perm -1000 -type d 2>/dev/null   
```  
SGID (chmod 2000) - run as the group, not the user who started it. 
```bash
find / -perm -g=s -type f 2>/dev/null    
```
SUID (chmod 4000) - run as the owner, not the user who started it. 

    find / -perm -u=s -type f 2>/dev/null    
SGID or SUID < full search  
```bash
find / -perm -g=s -o -perm -u=s -type f 2>/dev/null 
```
Looks in 'common' places: /bin, /sbin < quicker  

```bash
for i in `locate -r "bin$"`; do find $i \( -perm -4000 -o -perm -2000 \) -type f 2>/dev/null; done    

-find starting at root (/), SGID or SUID, not Symbolic links, only 3 folders deep, list with more detail and hide any errors (e.g. permission denied)
find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \; 2>/dev/null  

find / perm /u=s -user "User name that you are looking for" 2>/dev/null  
```
### Writable file and nobody files  
world-writeable files 
```bash
find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print   
```
Noowner files  
```bash
find /dir -xdev \( -nouser -o -nogroup \) -print 
```
### Writable by current user  
```bash
find / perm /u=w -user `whoami` 2>/dev/null  
find / -perm /u+w,g+w -f -user `whoami` 2>/dev/null  
find / -perm /u+w -user `whoami` 2>/dev/null  
```
### world-writeable folders
```bash
find / -writable -type d 2>/dev/null
find / -perm -222 -type d 2>/dev/null
find / -perm -o w -type d 2>/dev/null
```
### Any script files that we can modify?  
find all python file that can be write by us  
```bash
find / -writable -type f -name "*.py" 2>/dev/null  

ls -aRl / | awk '$1 ~ /^.*w.*/' 2>/dev/null     # Anyone  
ls -aRl / | awk '$1 ~ /^..w/' 2>/dev/null       # Owner  
ls -aRl / | awk '$1 ~ /^.....w/' 2>/dev/null    # Group  
ls -aRl / | awk '$1 ~ /w.$/' 2>/dev/null        # Other  

find / -readable -type f 2>/dev/null               # Anyone  
find / -readable -type f -maxdepth 1 2>/dev/null   # Anyone  
```
### Any service running by root?  
```bash
ps aux|grep "root"  

/usr/bin/journalctl (Which is normally not readable by a user)              << cron job?  
```
### Find password  
```bash
grep -rnw '/' -ie 'pass' --color=always 2>/dev/null 
grep -rnw '/' -ie 'password' --color=always 2>/dev/null 
grep -rnw '/' -ie 'DB_PASS' --color=always 2>/dev/null
grep -rnw '/' -ie 'DB_PASSWORD' --color=always 2>/dev/null
grep -rnw '/' -ie 'DB_USER' --color=always 2>/dev/null

find / -type f -regex '.*\.\(php\|log\|xml\|txt\)' -exec grep --color=auto  -i 'password' {} \; -print 2>/dev/null
```
# Exploit Time
## SUID
### Is there a custom suid application?  
How can this application be run?  
Can be modify the path variable so that it will execute something else  

## NFS priv esc
https://medium.com/@Kan1shka9/hacklab-vulnix-walkthrough-b2b71534c0eb

## Linux capability
```bash
find / -type f -print0 2>/dev/null | xargs -0 getcap 2>/dev/null
    getcap -r /
```
google that capability on how it can help us get root

## Mysql run by root
MySQL 4.x/5.0 (Linux) - User-Defined Function (UDF) Dynamic Library
https://www.exploit-db.com/exploits/1518/

You can also try
select sys_exec('echo test>/tmp/test.txt');
select sys_eval('echo test>/tmp/test.txt');